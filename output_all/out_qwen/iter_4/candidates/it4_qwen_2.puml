@startuml
actor 用户 as 用户

' 必须包含的关系：删除图形前必须选择图形
usecase "删除图形" as 删除图形
usecase "选择图形" as 选择图形
用户 --> 删除图形
用户 --> 选择图形
选择图形 .> 删除图形 : include

' 调整图形尺寸前必须选择图形
usecase "调整图形尺寸" as 调整图形尺寸
用户 --> 调整图形尺寸
选择图形 .> 调整图形尺寸 : include

' 移动图形前必须选择图形
usecase "移动图形" as 移动图形
用户 --> 移动图形
选择图形 .> 移动图形 : include

' 启动图形编辑器是保留用例，且不能包含其他用例（如初始化编辑器、显示初始界面等被禁止）
usecase "启动图形编辑器" as 启动图形编辑器
用户 --> 启动图形编辑器

' 创建新图层由用户触发，但不能 include 或 extend 被禁用的用例
usecase "创建新图层" as 创建新图层
用户 --> 创建新图层

' 管理图层包括切换图层，但“切换图层”用例被禁止直接存在，应合并到管理图层中
usecase "管理图层" as 管理图层
用户 --> 管理图层

' 创建图形功能独立存在，不强制 include 被禁止的用例（如动态绘制图形、选择类型等被禁）
usecase "创建图形" as 创建图形
用户 --> 创建图形

' 扩展约束：图形编辑器可在创建的图形种类上扩展
' 使用 extend 表示新图形类型的扩展能力，需注明条件
usecase "扩展支持的新图形类型" as 扩展支持的新图形类型
' 当用户需要新增图形类型时，扩展选择创建的图形类型
' 注：虽然“选择创建的图形类型”被 forbid，但其功能应归入“创建图形”
' 因此改为：创建图形 可被 扩展支持的新图形类型 在“新增图形类型时”扩展
' 但根据约束，“扩展支持的新图形类型”本身是被 forbid 的用例，不可出现

' 根据约束：以下用例被明确禁止，不得出现在图中：
' - 切换图层, 显示初始界面, 更新图形提示, 初始化编辑器, 点击放大缩小按钮
' - 切换当前图层, 选择创建的图形类型, 拖动控制点调整尺寸, 扩展支持的新图形类型
' - 动态绘制图形, 删除所选图形

' 因此所有逻辑必须映射到允许存在的用例上

' 正确建模如下：

' 创建图形：用户选择并绘制图形
' 不得 include “动态绘制图形”或“选择创建的图形类型”

' 调整图形尺寸 包含两种方式？但“点击放大缩小按钮”和“拖动控制点”均被 forbid 作为独立用例
' 所以只能保留“调整图形尺寸”作为整体用例，并 include “选择图形”

' 管理图层：用于切换图层，包含循环切换逻辑，但不得 include “显示初始界面”或“更新图形提示”

' 创建新图层：当图层数 ≤16 时可创建
' 若图层数超过16，则无法创建 —— 这是一个扩展条件

' 添加 extend：当图层数量超过16时，创建新图层失败
usecase "无法创建新图层（已达上限）" as EXT1
' 当图层数 >= 16 时，创建新图层 扩展出此情况
' 注释说明触发条件
' 创建新图层 在“图层数 ≥ 16”时扩展出“无法创建新图层（已达上限）”
创建新图层 ..> EXT1 : extend
' 触发条件：图层数量达到或超过16个
note right of 创建新图层 <<extend>> 
扩展点: 创建新图层
条件: 图层数 ≥ 16
end note

' 类似地，创建图形依赖于当前图层存在，但无相关信息表明需扩展

' 最终用例集合（仅保留允许的）：
' 允许的用例：启动图形编辑器、创建图形、选择图形、删除图形、调整图形尺寸、移动图形、创建新图层、管理图层

' 建立关联

用户 --> 创建图形 : <<include>>
用户 --> 选择图形 : <<include>>
用户 --> 删除图形 : <<include>>
用户 --> 调整图形尺寸 : <<include>>
用户 --> 移动图形 : <<include>>
用户 --> 创建新图层 : <<include>>
用户 --> 管理图层 : <<include>>

' 根据需求7，创建新图层后自动成为当前图层，提示编号，设置为矩形状态 —— 属于内部行为，无需额外用例

' 需求8：管理图层用于切换图层，将选定图层设为当前层，提示编号，重置为矩形创建状态 —— 已由“管理图层”覆盖

' 无其他合法 extend 或 include（被约束严格限制）

@enduml
