@startuml
actor 用户 as User

'
' 根据需求提取的核心用例（排除 forbid_usecases 中列出的）
'
usecase "启动图形编辑器" as usecase1 <<Forbidden>> 
usecase "创建图形" as usecase2
usecase "选择图形" as usecase3
usecase "删除图形" as usecase4
usecase "改变图形尺寸" as usecase5
usecase "移动图形" as usecase6
usecase "创建图层" as usecase7
usecase "管理图层" as usecase8

'
' 由于以下用例在 forbid_usecases 列表中，不应作为独立用例出现：
' 取消图形选择, 启动图形编辑器, 初始化编辑区域, 拖动控制点调整尺寸, 重置图形工具状态,
' 动态绘制图形, 提示新图层编号, 点击缩小按钮, 切换当前图层, 点击放大按钮,
' 限制图层数量≤16, 显示初始提示信息, 多选图形, 删除所选图形, 单选图形
'
' 因此将相关行为通过 include/extend 整合到主用例中

'
' 满足硬性要求：actor -> usecase 关联
'
User --> usecase2 : 创建图形
User --> usecase3 : 选择图形
User --> usecase4 : 删除图形
User --> usecase5 : 改变图形尺寸
User --> usecase6 : 移动图形
User --> usecase7 : 创建图层
User --> usecase8 : 管理图层

'
' include 关系：强制依赖（A 必须包含 B）
'

' 创建图形过程中必须动态绘制所选图形（虚线预览）并隶属于当前图层 '
' usecase2 includes 动态绘制图形 -- 已禁止，故不显式建模 '

' 选择图形功能包含单选和多选的情况，但“多选图形”和“单选图形”被禁止，需合并 '
' 故 usecase3 包含内部逻辑判断，无需拆分为子用例 '

' 删除图形前必须先选择图形 '
' 删除图形依赖于选择图形的状态 '
usecase4 .> usecase3 : <<include>>
' 删除图形必须基于已选择的图形 '

' 改变图形尺寸可通过两种方式：拖动控制点或点击放大/缩小按钮 '
' 但“拖动控制点调整尺寸”、“点击放大按钮”、“点击缩小按钮”均被禁止作为独立用例 '
' 所以这些是改变图形尺寸的内部实现方式，不单独建模 '

' 创建图层后必须设置为当前图层，并重置图形工具状态为“矩形” '
' “重置图形工具状态”被禁止，故作为创建图层的一部分 '
usecase7 .> usecase2 : <<include>>
' 新图层创建后默认处于创建矩形状态，因此创建图层包含初始创建图形类型设置 '

' 管理图层涉及图层切换，若当前为最后一页则跳转至第一页 '
' “切换当前图层”被禁止，故作为管理图层的内部行为 '

' 创建图层时若图层数已达16则无法继续，但“限制图层数量≤16”被禁止作为独立用例 '
' 因此该约束作为创建图层的前提条件或扩展点 '

'
' extend 关系：可选扩展（B 在特定条件下扩展 A）
'

' 当图层数小于16时才能创建新图层，否则无法创建 '
usecase7 ..> usecase7 : <<extend>>
' 图层数量 < 16 是创建图层的扩展条件 '
note on link
  扩展条件：仅当现有图层数 < 16 时，
  才能执行创建图层操作
end note

' 管理图层操作可能循环切换（到最后一个后切回第一个） '
usecase8 ..> usecase8 : <<extend>>
' 扩展条件：当前图层为最后一个时，“下一页”切换至第一个 '
note on link
  扩展条件：当点击“下一页”且当前为最后一页时，
  自动切换至第一页
end note

@enduml
