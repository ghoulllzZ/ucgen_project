@startuml
actor 用户

'
' 启动与初始化相关用例
'
用户 -> "启动图形编辑器" : 启动软件
"启动图形编辑器" --> "创建初始图层" : 必须包含初始图层
' 启动时必须创建第一个编辑图层
"启动图形编辑器" --> "显示第一页提示" : 必须提示页码
' 启动时图形提示区域显示“第一页”
"启动图形编辑器" --> "设置默认创建图形为矩形" : 默认选择矩形工具
' 创建图形选择框默认显示矩形

'
' 图层管理功能
'
用户 -> "创建新图层" : 点击“新页”按钮
' 用户可创建新图层，最多16个
"创建新图层" --> "限制最多16个图层" : 超过16个则禁止创建
' 不允许超过16个图层
"创建新图层" --> "提示新图层编号" : 显示新图层编号
' 图形提示区域给出编号提示
"创建新图层" --> "设置新图层为当前图层" : 新图层自动成为当前图层
' 切换当前编辑图层为目标新图层
"创建新图层" --> "重置创建图形为矩形" : 操作状态重置为矩形
' 新图层创建图形选择框显示“矩形”

用户 -> "切换图层" : 点击“下一页”按钮
' 用户切换图层
"切换图层" --> "循环切换至首页" : 当前为最后一页时跳转第一页
' 实现循环切换逻辑
"切换图层" --> "重置创建图形为矩形" : 切换后重置为矩形状态
' 图层切换后图形选择框恢复为矩形

'
' 图形操作主用例
'
用户 -> "创建图形" : 选择形状并拖动绘制
' 用户从选择框选形状并在编辑区绘制
"创建图形" --> "选择直线、椭圆或矩形" : 指定要创建的图形类型
' 必须先选择图形类型
"创建图形" --> "在编辑区域绘制图形" : 实际绘制行为
' 在当前图层上进行绘制
"创建图形" --> "动态绘制图形" : 绘制过程中虚线预览
' 拖动时动态显示虚线轮廓

用户 -> "选择图形" : 选择一个或多个图形
' 选择图形以进行后续操作
"选择图形" --> "单选图形" : 点击图形内部进行单选
' 单个图形的选择方式
"选择图形" --> "多选图形" : 拖拽框选多个图形
' 在叠加区域点击或拖拽选择多个
"选择图形" --> "取消选择" : 在空白处点击取消选择
' 取消所有已选择图形

用户 -> "删除所选图形" : 点击“删除元素”按钮
' 删除已选择的图形
"删除所选图形" <-- "选择图形" : 必须先选择才能删除
' 删除依赖于选择结果

用户 -> "调整图形尺寸" : 改变图形大小
' 调整已选择图形的尺寸
"调整图形尺寸" --> "拖动控制点调整尺寸" : 通过控制点拖动改变
' 四角控制点用于拉伸
"调整图形尺寸" --> "使用放大按钮" : 点击“放大”按钮整体放大
' 直接放大所选图形
"调整图形尺寸" --> "使用缩小按钮" : 点击“缩小”按钮整体缩小
' 直接缩小所选图形

用户 -> "移动图形" : 在图形内按下并拖动
' 拖动已选择图形到新位置
' 移动时不改变图层和选择状态

'
' 扩展性说明（约束允许扩展图形种类）
'
' 图形编辑器可在创建的图形种类上扩展
note right of "创建图形"
    【约束】图形编辑器可在创建的图形种类上扩展
end note

'
' 强制约束执行：保留必要用例，禁用被禁止的用例
'
' 显式移除 forbid_usecases 中列出的所有用例（不声明即视为排除）
' 如：“点击删除按钮”、“点击放大按钮”等细粒度操作合并到高层用例中

'
' 关系约束实施
'
' 禁止关系：根据 forbid_include 和 forbid_extend
' 例如：启动不能 include 创建新图层、选择图形等
' 已通过不绘制这些箭头来遵守

' include 因果说明（显式满足 must_include）
"选择图形" ..> "选择图形" : <<include>>
' 【约束强制】选择图形必须包含自身（视为恒成立基础操作）

'
' extend 关系：当前无必须 extend，且 forbid_extend 存在
'
' 禁止：切换图层 extend 创建新图层 → 不绘制该关系

@enduml
